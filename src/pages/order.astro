---
import Layout from '../layouts/Layout.astro';
import { getProducts } from '../utils/storage';
---

<Layout title="Place Order - Flower Lighting">
    <div class="flex flex-col gap-12 pb-16 max-w-2xl mx-auto">
        <section class="text-center pt-8">
            <h1 class="text-4xl sm:text-5xl font-bold text-white mb-4">Place Your Order</h1>
            <p class="text-xl text-gray-300">Fill out the form below to order from Flower Lighting</p>
        </section>

        <section class="bg-dark-card border border-dark-border rounded-lg p-8">
            <form id="orderForm" class="flex flex-col gap-6">
                <div>
                    <label for="name" class="block text-white font-semibold mb-2">Full Name</label>
                    <input 
                        type="text" 
                        id="name" 
                        name="name" 
                        required
                        class="w-full px-4 py-3 bg-dark-bg border border-dark-border rounded-lg text-white focus:outline-none focus:border-primary transition-colors"
                        placeholder="Your full name"
                    />
                </div>

                <div>
                    <label for="phone" class="block text-white font-semibold mb-2">Phone Number</label>
                    <input 
                        type="tel" 
                        id="phone" 
                        name="phone" 
                        required
                        class="w-full px-4 py-3 bg-dark-bg border border-dark-border rounded-lg text-white focus:outline-none focus:border-primary transition-colors"
                        placeholder="+966 5X XXX XXXX"
                    />
                </div>

                <div>
                    <label for="item" class="block text-white font-semibold mb-2">Select Product</label>
                    <select 
                        id="item" 
                        name="item" 
                        required
                        class="w-full px-4 py-3 bg-dark-bg border border-dark-border rounded-lg text-white focus:outline-none focus:border-primary transition-colors"
                    >
                        <option value="">Choose a product...</option>
                        {getProducts().map(product => (
                            <option value={product.name}>{product.name} - SR {product.price}</option>
                        ))}
                    </select>
                </div>

                <div>
                    <label for="quantity" class="block text-white font-semibold mb-2">Quantity</label>
                    <input 
                        type="number" 
                        id="quantity" 
                        name="quantity" 
                        min="1"
                        max="100"
                        value="1"
                        required
                        class="w-full px-4 py-3 bg-dark-bg border border-dark-border rounded-lg text-white focus:outline-none focus:border-primary transition-colors"
                    />
                </div>

                <div>
                    <label class="block text-white font-semibold mb-3">Delivery Method</label>
                    <div class="flex gap-6">
                        <div class="flex items-center">
                            <input 
                                type="radio" 
                                id="delivery" 
                                name="deliveryType" 
                                value="delivery"
                                checked
                                class="w-4 h-4 cursor-pointer"
                            />
                            <label for="delivery" class="ml-2 text-gray-300 cursor-pointer">Delivery</label>
                        </div>
                        <div class="flex items-center">
                            <input 
                                type="radio" 
                                id="pickup" 
                                name="deliveryType" 
                                value="pickup"
                                class="w-4 h-4 cursor-pointer"
                            />
                            <label for="pickup" class="ml-2 text-gray-300 cursor-pointer">Pickup</label>
                        </div>
                    </div>
                </div>

                <button 
                    type="submit"
                    class="w-full px-6 py-4 bg-primary text-dark-bg font-bold rounded-lg hover:opacity-90 transition-opacity text-lg mt-4"
                >
                    Submit Order
                </button>
            </form>
        </section>

        {/* Confirmation Message */}
        <div id="confirmationMessage" class="hidden bg-green-900 border border-green-700 rounded-lg p-8 text-center">
            <div class="text-5xl mb-4">âœ“</div>
            <h2 class="text-2xl font-bold text-white mb-4">Order Submitted Successfully!</h2>
            <p class="text-gray-300 mb-6">Thank you for your order. Our team will contact you shortly to confirm details.</p>
            <a href="/" class="inline-block px-6 py-3 bg-primary text-dark-bg font-bold rounded-lg hover:opacity-90 transition-opacity">
                Back to Home
            </a>
        </div>
    </div>
</Layout>

<script>
    document.getElementById('orderForm')?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const form = e.target as HTMLFormElement;
        
        const formData = {
            name: (form.querySelector('[name="name"]') as HTMLInputElement).value,
            phone: (form.querySelector('[name="phone"]') as HTMLInputElement).value,
            item: (form.querySelector('[name="item"]') as HTMLInputElement).value,
            quantity: parseInt((form.querySelector('[name="quantity"]') as HTMLInputElement).value),
            deliveryType: (form.querySelector('[name="deliveryType"]:checked') as HTMLInputElement).value as 'delivery' | 'pickup'
        };

        // Get storage utility function
        const { addOrder } = await import('../utils/storage');
        
        try {
            // Add order to storage
            addOrder({
                name: formData.name,
                phone: formData.phone,
                item: formData.item,
                quantity: formData.quantity,
                deliveryType: formData.deliveryType
            });

            // Show confirmation and hide form
            const form = document.getElementById('orderForm');
            const confirmation = document.getElementById('confirmationMessage');
            if (form) form.style.display = 'none';
            if (confirmation) confirmation.classList.remove('hidden');
        } catch (error) {
            console.error('Error submitting order:', error);
            alert('Error submitting order. Please try again.');
        }
    });
</script>
